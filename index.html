<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Egress Window Calculator (Canada)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <style>
    /* [Same CSS as in your original, unchanged for brevity] */
  </style>
</head>
<body>
  <div class="egress-calculator">
    <img src="images/Logo.png" alt="JELD-WEN Logo" width="200" height="70">
    <h2 id="title">Canadian Egress Window Calculator</h2>
    <p class="definition" id="definition"></p>

    <label for="windowType" id="windowTypeLabel">Window Type:</label>
    <select id="windowType" onchange="egressCalculate()">
      <option value="" disabled selected>Select a window type</option>
      <option value="Casement">Casement</option>
      <option value="Slider">Slider</option>
      <option value="Awning">Awning</option>
      <option value="Single-hung">Single Hung</option>
      <option value="Double-hung">Double Hung</option>
      <option value="Fixed">Fixed</option>
    </select>

    <label for="width" id="widthLabel">Width (inches):</label>
    <input type="number" id="width" min="0" step="0.1" oninput="egressCalculate()">

    <label for="height" id="heightLabel">Height (inches):</label>
    <input type="number" id="height" min="0" step="0.1" oninput="egressCalculate()">

    <label for="unit" id="unitLabel">Unit:</label>
    <select id="unit" onchange="egressCalculate()">
      <option value="in">Inches</option>
      <option value="cm">Centimeters</option>
    </select>

    <div class="result" id="egress-result"></div>

    <script>
      const pathLang = window.location.pathname.includes("/fr-ca") ? "fr" : "en";

      const translations = {
        en: {
          title: "Canadian Egress Window Calculator",
          definition: "<strong>Note:</strong> According to the <em>National Building Code of Canada 2020</em>, bedroom egress windows must provide an <strong>unobstructed opening</strong> of at least <strong>0.35 m² (3.77 ft²)</strong>, with no dimension less than <strong>380 mm (15 inches)</strong> in height or width...",
          windowTypeLabel: "Window Type:",
          widthLabel: "Width (inches):",
          heightLabel: "Height (inches):",
          unitLabel: "Unit:",
          selectWindowType: "Please select a window type.",
          enterDimensions: "Please enter both width and height.",
          windowType: "Window Type",
          effectiveOpening: "Effective Opening",
          clearArea: "Clear Opening Area",
          notEgressFixed: "❌ Fixed windows cannot be used for egress.",
          cautionAwning: "⚠️ Awning windows may not meet egress requirements due to limited opening clearance.",
          passes: "✅ Meets Canadian egress requirements (NBC 2020).",
          guidance: "For guidance only—check with your local municipality for specific requirements.",
          fails: "❌ Does NOT meet Canadian egress requirements (NBC 2020)."
        },
        fr: {
          title: "Calculateur de Fenêtre de Sortie (Canada)",
          definition: "<strong>Remarque :</strong> Selon le <em>Code national du bâtiment du Canada 2020</em>, les fenêtres de sortie des chambres doivent offrir une <strong>ouverture dégagée</strong> d'au moins <strong>0,35 m² (3,77 ft²)</strong>...",
          windowTypeLabel: "Type de Fenêtre :",
          widthLabel: "Largeur (pouces) :",
          heightLabel: "Hauteur (pouces) :",
          unitLabel: "Unité :",
          selectWindowType: "Veuillez sélectionner un type de fenêtre.",
          enterDimensions: "Veuillez entrer la largeur et la hauteur.",
          windowType: "Type de Fenêtre",
          effectiveOpening: "Ouverture Effective",
          clearArea: "Surface d'Ouverture Dégagée",
          notEgressFixed: "❌ Les fenêtres fixes ne peuvent pas être utilisées pour la sortie.",
          cautionAwning: "⚠️ Les fenêtres à auvent peuvent ne pas répondre aux exigences de sortie...",
          passes: "✅ Répond aux exigences de sortie canadiennes (NBC 2020).",
          guidance: "À titre indicatif seulement—vérifiez auprès de votre municipalité locale.",
          fails: "❌ Ne répond PAS aux exigences de sortie canadiennes (NBC 2020)."
        }
      };

      function applyLanguage() {
        const t = translations[pathLang];
        document.getElementById('title').textContent = t.title;
        document.getElementById('definition').innerHTML = t.definition;
        document.getElementById('windowTypeLabel').textContent = t.windowTypeLabel;
        document.getElementById('widthLabel').textContent = t.widthLabel;
        document.getElementById('heightLabel').textContent = t.heightLabel;
        document.getElementById('unitLabel').textContent = t.unitLabel;
      }

      function capitalizeWords(str) {
        return str.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
      }

      function egressCalculate() {
        const widthInput = parseFloat(document.querySelector('#width').value);
        const heightInput = parseFloat(document.querySelector('#height').value);
        const unit = document.querySelector('#unit').value;
        const type = document.querySelector('#windowType').value.toLowerCase();
        const result = document.querySelector('#egress-result');
        const t = translations[pathLang];

        if (!type) {
          result.textContent = t.selectWindowType;
          return;
        }

        if (!widthInput || !heightInput) {
          result.textContent = t.enterDimensions;
          return;
        }

        const width = unit === "cm" ? widthInput / 2.54 : widthInput;
        const height = unit === "cm" ? heightInput / 2.54 : heightInput;

        if (type === "fixed") {
          result.innerHTML = `<strong>${t.windowType}:</strong> ${capitalizeWords(type)}<br><span style='color:red'>${t.notEgressFixed}</span>`;
          return;
        }

        let effectiveWidth = width;
        let effectiveHeight = height;

        if (["slider", "single-hung", "double-hung"].includes(type)) {
          effectiveWidth = width / 2;
        }

        const areaInSqInches = effectiveWidth * effectiveHeight;
        const areaInSqFeet = areaInSqInches / 144;
        const minAreaInSqInches = 543.6;
        const minDimension = 15;

        const meetsArea = areaInSqInches >= minAreaInSqInches;
        const meetsDimension = effectiveWidth >= minDimension && effectiveHeight >= minDimension;

        let complianceMessage = "";

        if (type === "awning") {
          complianceMessage = `<span style='color:orange'>${t.cautionAwning}</span>`;
        } else if (meetsArea && meetsDimension) {
          complianceMessage = `<span style='color:green'>${t.passes}</span><br><span>${t.guidance}</span>`;
        } else {
          complianceMessage = `<span style='color:red'>${t.fails}</span>`;
        }

        result.innerHTML = `
          <strong>${t.windowType}:</strong> ${capitalizeWords(type)}<br>
          <strong>${t.effectiveOpening}:</strong> ${effectiveWidth.toFixed(1)}" x ${effectiveHeight.toFixed(1)}"<br>
          <strong>${t.clearArea}:</strong> ${areaInSqInches.toFixed(2)} in² (${areaInSqFeet.toFixed(2)} ft²)<br>
          ${complianceMessage}
        `;
      }

      applyLanguage();
    </script>
  </div>
</body>
</html>
